/// A world holding all archetypes.
#[derive(Debug, Clone)]
pub struct World {
    {%- for archetype in ecs.archetypes %}
    pub {{ archetype.name.field | snake_case }}: {{ archetype.name.type }},
    {%- endfor %}
}

impl World {
    /// Apply all system phases.
    pub fn apply_system_phases(&mut self) {
        {%- for phase in ecs.phases %}
        self.apply_system_phase_{{ phase.name.field }}();
        {%- endfor %}
    }
    {%- for phase in ecs.phases %}

    /// Execute system phase `{{ phase.name.raw }}`
    pub fn apply_system_phase_{{ phase.name.field }}(&mut self) {
        // TODO: Emit hook for begin of system phase
        {%- if ecs.scheduled_systems[phase.name] | length == 0 %}
        // no systems in this phase
        {%- else %}
        {%- for group in ecs.scheduled_systems[phase.name] %}
        // Execute system group {{ loop.index }}
        {%- for system in group %}
        // Run system {{ system.name.raw }}
        {%- endfor %}
        {%- endfor %}
        {%- endif %}
        // TODO: Emit hook for end of system phase
    }
    {%- endfor %}
}
